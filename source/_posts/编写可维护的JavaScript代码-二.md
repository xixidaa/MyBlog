---
title: 编写可维护的JavaScript代码(二)
date: 2018-02-23 14:47:56
tags:
---

## 4,变量,函数和运算符#

### 4.1 变量声明

变量声明是通过var来完成的.js中允许多次使用var语句,此外var语句几乎可以用在JavaScript脚本中的任意地方.

>作者建议你总是将局部变量的定义,作为函数内的第一条语句
>
>同时将所有的var语句合并为一个语句,每个变量的初始化独占一行.赋值运算符应当对齐.对于那些没有初始值的变量来说,他们应当出现在var语句的尾部

````js
function fn(items) {
    
    var value = 10,
        result = value + 10,
        i,
        len;
    
    for (i=0, len=items.length; i < len; i++) {
        console.log(items[i]);
    }
}
````

前端瓶颈:    数学思维   +   算法思维   +  逻辑思维

### 4.2, 函数声明

和变量声明一样,函数声明也会被JavaScript引擎提前.所以推荐总是先声明函数,再使用函数

### 4.3, 函数调用间隔

一般来讲,对于函数调用的写法推荐的风格是:**在函数名和左括号之间没有空格**,这样做是为了将他和块语句区分开.

### 4.3, 立即调用函数

JavaScript中允许声明匿名函数(本身没有命名的函数),并将匿名函数的值赋值给变量或者属性.

为了让立即执行函数能够一眼看出来,可以将函数用一对圆括号包裹起来.

### 4.5, 严格模式

ES5 引入了严格模式,希望通过这种方式来谨慎的解析JavaScript代码,以减少错误.

>```js
>"use strict";
>```

这条编译指令不仅用于全局,也适用于局部,比如函数内.**不建议**将"use strict"用于**全局**,因为会使文件中的所有代码都以严格模式进行解析.

* 如果你希望在多个函数中使用严格模式而不必写多行use strict的话,可以使用立即执行函数.

  ````js
  //好的写法
  (function() {
      "use strict";
      function a() {
          //代码
      }
      function b() {
          //代码
      }
  })();
  ````

  

### 4.6, 相等

由于JavaScript有**强制类型转换**机制, JavaScript判断相等操作是很微妙的.对于某些运算来说,为了得到正确的结果,强制类型转化会驱使某种类型的变量自动转化成其他的不同类型,这往往会得到意想不到的结果.

发生强制类型转化的最常见情形是,使用了判断相等运算符==和!=的时候.当要比较两个值的类型不相等时,这两个运算符都有强制类型转化(**数据类型相同时则不会有类型转化**).但在很多情况下,代码并不按照我所期望的方式运行.

* 如果将数字和字符串进行比较的时候,字符串首先会转换成数字,然后执行比较.

* 如果一个布尔值和数字进行比较,布尔值会首先转成数字,然后执行比较.false转化成0,true转化成1.

* 如果其中一个值是对象而另一个不是,则会先调用对象的valueof()方法,得到原始类型进行比较.如果没有定义valueof(),则调用toString().之后比较的操作就和上文中提到的多类型值比较情形一样了.

  >````js
  >var object = {
  >    toString: function() {
  >        return "0x19";
  >    }
  >};
  >
  >console.log(object == 25); //true
  >````

* 还有一种涉及到强制类型转化的场景和null和undefined有关.根据ESMAScript标准规范的描述,这两个特殊值被认为是相等的.

  ````js
  console.log(null == undefined); //true
  ````

  

* 由于强制类型转化的缘故,我们推荐不要使用==和!=,而是采用三等.

### 4.7,原始包装类型

JavaScript中的一个不易被了解且被常常误解的方面是,这门语言对**原始包装类型(primitive wrapper types)**的依赖.

* JavaScript中有三种原始包装类型:String,Boolean和Number.每种类型的作用域都代表全局作用域中的一个构造函数,并分别表示各自对应的原始值的对象.**原始包装类型的主要作用是让原始值具有对象般的行为**                           

  >````js
  >var name = "zhangsan";
  >console.log(name.toUpperCase);
  >````
  >

  <table><tr><td bgcolor=yellow><font color=red>尽管name是一个字符串,是原始类型而不是对象,但你仍然可以使用诸如toUpperCase的方法,即将字符串当做对象来对待.这种做法之所以行得通,是因为在这条语句的表象背后,是因为JavaScript引擎创建了String的类型的新实例,紧跟着就被销毁了,当再次需要时就会又创建另一个对象.需要尤为注意的一点，原始值本身不具有对象特性，比如1.toString()是报错的，必须这样做：var a = 1;a.toString()</font></td></tr></table>

## 5, UI层的松耦合
在web开发过程中，用户界面（UI）是三个彼此隔离而又相互作用的层定义的。
* HTML用来定义页面的数据和语义。
* CSS用来给页面添加样式，创建视觉特征。
* JavaScript用来给页面添加行为，使其更具交互性。

### 5.1, 什么是松耦合
* 紧耦合:如果两个组件耦合太紧，则说明一个组件和另一个组件直接相关，这样的话，如果修改一个组件的逻辑，那么另外一个组件的逻辑也要修改。
* 松耦合:当你能够做到修改一个组件而不需要更改其他组件的时候，你就做到了松耦合。对于多人的大型系统来说，有很多人参与维护代码，松耦合对于代码的可维护性来说至关重要。当一个大型系统的每一个组件的内容都有了限制，你就做到了松耦合。
* 如果一个Web UI是松耦合的,则很容易调试。和文本或者结构相关的问题，通过查找HTML就能定位。当发生了样式相关的问题，你就知道问题出在CSS。最后，对于那些行为相关的问题，你直接去JS中查找问题的所在，这种能力是WEB界面的可维护性的核心部分。

### 5.2,将JavaScript从CSS中抽离
在IE8之前的浏览器版本存在CSS表达式的特性，它允许你将JavaScript代码直接插入到CSS里面，这样可以在CSS中直接执行运算或者其他操作。浏览器会以高频率重复计算CSS表达式，这严重影响性能。另外对于代码维护来说也是一场灾难。

### 5.3, 将CSS从JS中抽离
保持CSS和JS之间清晰的分离是很有挑战性的。我们经常将样式数据和JS混写在一起。通过脚本修改样式的最流行的一种方式是，直接修改Dom元素的style属性。style属性是一个对象，包含了可以读取和修改的CSS属性。
* 将CSS从JS分离意味着所有的样式信息都应当保持在CSS中。当需要通过JS修改元素样式的时候，最佳的方法是操作CSS的className。

### 5.4,  将JS从HTML中分离
* 你的绝大多数的JS代码都应当包含在外部文件中，并在页面中通过<script>标签进行引用。在HTML代码中也不应该直接给on属性挂载事件处理程序。相反，一旦外部脚本文件加载至页面，则使用JS方法添加事件处理程序。
* 在HTML中嵌入JS代码的另一种方法是使用<script>标签，标签内包含的内联的脚本代码。
* 作者建议最好将JS代码放入内置文件中，以确保HTML代码中不会有内联的JS代码。这样做的原因是出于紧急调试的考虑。

### 5.5, 将HTML代码从JS中抽离
当需要调试一个文本或者是结构性问题时，你更希望从HTML中调试。一个典型的情形是给innerHTML属性赋值的时候。
将HTML代码嵌入到JS代码中是非常不好的实践，原因如下：
* 1.它增加了跟踪文本和结构性文本问题的复杂度。
* 2.代码的可维护性不高。
  解决方法:在JS中通过向服务器发送请求获取数据,在客户端使用模板引擎,实现向页面中注入HTML代码.